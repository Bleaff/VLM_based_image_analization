version: "3.8"
services:
  ollama:
    image: ollama/ollama:latest
    container_name: ollama
    volumes:
      - ollama-data:/root/.ollama
      - ./ollama-entrypoint.sh:/usr/local/bin/ollama-entrypoint.sh:ro
    ports:
      - "11434:11434"
    restart: unless-stopped
    entrypoint: ["/usr/local/bin/ollama-entrypoint.sh"]
    gpus:
      - device: "all"
  app:
    build:
      context: .
      dockerfile: Dockerfile.app
    volumes:
      - ./config:/app/config:ro
      - ./app:/app/app:ro
    environment:
      - APP_CONFIG_PATH=/app/config/config.yml
      - APP_OLLAMA_URL=http://ollama:11434/api/generate
    depends_on:
      - ollama
    ports:
      - "8081:8081"
    restart: unless-stopped

volumes:
  ollama-data:
